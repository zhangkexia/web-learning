function set_cookie(t,e,n,i){var o,a,r=new Date;r.setTime(r.getTime()+24*(e||30)*60*60*1e3),o="; expires="+r.toGMTString();for(a in t)document.cookie=a+"="+t[a]+o+"; domain="+(n||"douban.com")+"; path="+(i||"/")}function get_cookie(t){var e,n,i=t+"=",o=document.cookie.split(";");for(e=0;e<o.length;e++){for(n=o[e];" "==n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(i))return n.substring(i.length,n.length).replace(/\"/g,"")}return null}window.Douban="undefined"==typeof Douban?{}:Douban,function(){var t,e,n=document,i=window,o=window.__external_files_loaded=window.__external_files_loaded||{},a=window.__external_files_loading=window.__external_files_loading||{},r=function(t){return t.constructor===Array},c={autoLoad:!0,coreLib:["//img3.doubanio.com/js/jquery.min.js"],mods:{}},s=n.getElementsByTagName("script"),d=s[s.length-1],u=[],l=!1,f=[],h=function(t,e,i,r,c){var d=s[0];if(t){if(o[t])return a[t]=!1,void(r&&r(t,c));if(a[t])return void setTimeout(function(){h(t,e,i,r,c)},1);a[t]=!0;var u,l=e||t.toLowerCase().split(/\./).pop().replace(/[\?#].*/,"");if("js"===l?(u=n.createElement("script"),u.setAttribute("type","text/javascript"),u.setAttribute("src",t),u.setAttribute("async",!0)):"css"===l&&(u=n.createElement("link"),u.setAttribute("type","text/css"),u.setAttribute("rel","stylesheet"),u.setAttribute("href",t),o[t]=!0),u){if(i&&(u.charset=i),"css"===l)return d.parentNode.insertBefore(u,d),void(r&&r(t,c));u.onload=u.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(o[this.getAttribute("src")]=!0,r&&r(this.getAttribute("src"),c),u.onload=u.onreadystatechange=null)},d.parentNode.insertBefore(u,d)}}},p=function(t){if(t&&r(t)){for(var e,n=0,i=[],o=c.mods,a=[],s={},d=function(t){var e,n,i=0;if(s[t])return a;if(s[t]=!0,o[t].requires){for(n=o[t].requires;"undefined"!=typeof(e=n[i++]);)o[e]?(d(e),a.push(e)):a.push(e);return a}return a};"undefined"!=typeof(e=t[n++]);)o[e]&&o[e].requires&&o[e].requires[0]&&(a=[],s={},i=i.concat(d(e))),i.push(e);return i}},m=function(){l=!0,u.length>0&&(e.apply(this,u),u=[])},g=function(){n.addEventListener?n.removeEventListener("DOMContentLoaded",g,!1):n.attachEvent&&n.detachEvent("onreadystatechange",g),m()},y=function(){if(!l){try{n.documentElement.doScroll("left")}catch(t){return i.setTimeout(y,1)}m()}},v=function(){if("complete"===n.readyState)return i.setTimeout(m,1);var t=!1;if(n.addEventListener)n.addEventListener("DOMContentLoaded",g,!1),i.addEventListener("load",m,!1);else if(n.attachEvent){n.attachEvent("onreadystatechange",g),i.attachEvent("onload",m);try{t=null===i.frameElement}catch(t){}document.documentElement.doScroll&&t&&y()}},_=function(t){t&&r(t)&&(this.queue=t,this.current=null)};_.prototype={_interval:10,start:function(){return this.current=this.next(),this.current?void this.run():void(this.end=!0)},run:function(){var t,e=this,n=this.current;return"function"==typeof n?(n(),void this.start()):void("string"==typeof n&&(c.mods[n]?(t=c.mods[n],h(t.path,t.type,t.charset,function(t){e.start()},e)):/\.js|\.css/i.test(n)?h(n,"","",function(t,e){e.start()},e):this.start()))},next:function(){return this.queue.shift()}},t=d.getAttribute("data-cfg-autoload"),"string"==typeof t&&(c.autoLoad="true"===t.toLowerCase()),t=d.getAttribute("data-cfg-corelib"),"string"==typeof t&&(c.coreLib=t.split(",")),e=function(){var t,e=[].slice.call(arguments);f.length>0&&(e=f.concat(e)),c.autoLoad&&(e=c.coreLib.concat(e)),t=new _(p(e)),t.start()},e.add=function(t,e){t&&e&&e.path&&(c.mods[t]=e)},e.delay=function(){var t=[].slice.call(arguments),n=t.shift();i.setTimeout(function(){e.apply(this,t)},n)},e.global=function(){var t=[].slice.call(arguments);f=f.concat(t)},e.ready=function(){var t=[].slice.call(arguments);return l?e.apply(this,t):void(u=u.concat(t))},e.css=function(t){var e=n.getElementById("do-inline-css");e||(e=n.createElement("style"),e.type="text/css",e.id="do-inline-css",n.getElementsByTagName("head")[0].appendChild(e)),e.styleSheet?e.styleSheet.cssText=e.styleSheet.cssText+t:e.appendChild(n.createTextNode(t))},c.autoLoad&&e(c.coreLib),e.define=e.add,e._config=c,e._mods=c.mods,this.Do=e,v()}(),Douban.init_show_login=function(t){Do("dialog",function(){var t="/j/misc/login_form";dui.Dialog({title:"登录",url:t,width:/device-mobile/i.test(document.documentElement.className)?.9*document.documentElement.offsetWidth:350,cache:!0,callback:function(t,e){e.node.addClass("dialog-login"),e.node.find("h2").css("display","none"),e.node.find(".hd h3").replaceWith(e.node.find(".bd h3")),e.node.find("form").css({border:"none",width:"auto",padding:"0"}),e.update()}}).open()})},Do(function(){$.ajax_withck=function(t){return"POST"==t.type&&(t.data=$.extend(t.data||{},{ck:get_cookie("ck")})),$.ajax(t)},$.postJSON_withck=function(t,e,n){return $.post_withck(t,e,n,"json")},$.post_withck=function(t,e,n,i){return $.isFunction(e)&&(i=n,n=e,e={}),$.ajax({type:"POST",url:t,data:$.extend(e,{ck:get_cookie("ck")}),success:n,dataType:i||"text"})},$("html").click(function(t){var e=$(t.target),n=e.attr("class");n&&$(n.match(/a_(\w+)/gi)).each($.proxy(function(e,n){var i=Douban[n.replace(/^a_/,"init_")];if("function"==typeof i){var o=i.call(this,t);o===!1&&t.preventDefault()}},e[0]))})});
